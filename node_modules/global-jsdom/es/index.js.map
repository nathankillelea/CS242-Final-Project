{"version":3,"sources":["../src/index.js"],"names":["JSDOM","defaultHtml","KEYS","globalJsdom","html","options","global","navigator","userAgent","indexOf","document","destroy","jsdom","window","length","push","Object","getOwnPropertyNames","filter","k","startsWith","forEach","key","console","$jsdom","cleanup"],"mappings":";;AAAA;;;AAGA,SAASA,KAAT,QAAsB,OAAtB;;AAEA,IAAMC,cACJ,8EADF;;AAGA;AACA;AACA,IAAMC,OAAO,EAAb;;AAEA,eAAe,SAASC,WAAT,GAAuD;AAAA,MAAlCC,IAAkC,uEAA3BH,WAA2B;AAAA,MAAdI,OAAc,uEAAJ,EAAI;;AACpE;AACA,MAAIC,OAAOC,SAAP,IACFD,OAAOC,SAAP,CAAiBC,SADf,IAEFF,OAAOC,SAAP,CAAiBC,SAAjB,CAA2BC,OAA3B,CAAmC,SAAnC,IAAgD,CAAC,CAF/C,IAGFH,OAAOI,QAHL,IAIF,OAAOJ,OAAOI,QAAP,CAAgBC,OAAvB,KAAmC,UAJrC,EAIiD;AAC/C,WAAOL,OAAOI,QAAP,CAAgBC,OAAvB;AACD;;AAED,MAAMC,QAAQ,IAAIZ,KAAJ,CAAUI,IAAV,EAAgBC,OAAhB,CAAd;AAVoE,MAW5DQ,MAX4D,GAWjDD,KAXiD,CAW5DC,MAX4D;AAAA,MAY5DH,QAZ4D,GAY/CG,MAZ+C,CAY5DH,QAZ4D;;AAcpE;AACA;AACA;;AAEA,MAAIR,KAAKY,MAAL,KAAgB,CAApB,EAAuB;AACrBZ,SAAKa,IAAL,gCAAaC,OAAOC,mBAAP,CAA2BJ,MAA3B,EAAmCK,MAAnC,CAA0C;AAAA,aAAK,CAACC,EAAEC,UAAF,CAAa,GAAb,CAAN;AAAA,KAA1C,EAAmEF,MAAnE,CAA0E;AAAA,aAAK,CAACZ,OAAOa,CAAP,CAAN;AAAA,KAA1E,CAAb;AACA;AACAjB,SAAKa,IAAL,CAAU,QAAV;AACD;AACD;AACAb,OAAKmB,OAAL,CAAa;AAAA,WAAOf,OAAOgB,GAAP,IAAcT,OAAOS,GAAP,CAArB;AAAA,GAAb;;AAEA;AACAhB,SAAOI,QAAP,GAAkBA,QAAlB;AACAJ,SAAOO,MAAP,GAAgBA,MAAhB;AACAA,SAAOU,OAAP,GAAiBjB,OAAOiB,OAAxB;;AAEA;AACAjB,SAAOkB,MAAP,GAAgBZ,KAAhB;;AAEA,MAAMa,UAAU,SAAVA,OAAU;AAAA,WAAMvB,KAAKmB,OAAL,CAAa;AAAA,aAAO,OAAOf,OAAOgB,GAAP,CAAd;AAAA,KAAb,CAAN;AAAA,GAAhB;;AAEAZ,WAASC,OAAT,GAAmBc,OAAnB;;AAEA,SAAOA,OAAP;AACD","file":"index.js","sourcesContent":["/*\n * enables jsdom globally.\n */\nimport { JSDOM } from 'jsdom'\n\nconst defaultHtml =\n  '<!doctype html><html><head><meta charset=\"utf-8\"></head><body></body></html>'\n\n// define this here so that we only ever dynamically populate KEYS once . this\n// way\nconst KEYS = []\n\nexport default function globalJsdom(html = defaultHtml, options = {}) {\n  // Idempotency\n  if (global.navigator &&\n    global.navigator.userAgent &&\n    global.navigator.userAgent.indexOf('Node.js') > -1 &&\n    global.document &&\n    typeof global.document.destroy === 'function') {\n    return global.document.destroy\n  }\n\n  const jsdom = new JSDOM(html, options)\n  const { window } = jsdom\n  const { document } = window\n\n  // generate our list of keys by enumerating document.window - this list may vary\n  // based on the jsdom version. filter out internal methods as well as anything\n  // that node already defines\n\n  if (KEYS.length === 0) {\n    KEYS.push(...Object.getOwnPropertyNames(window).filter(k => !k.startsWith('_')).filter(k => !global[k]))\n    // going to add our jsdom instance, see below\n    KEYS.push('$jsdom')\n  }\n  // eslint-disable-next-line no-return-assign\n  KEYS.forEach(key => global[key] = window[key])\n\n  // setup document / window / window.console\n  global.document = document\n  global.window = window\n  window.console = global.console\n\n  // add access to our jsdom instance\n  global.$jsdom = jsdom\n\n  const cleanup = () => KEYS.forEach(key => delete global[key])\n\n  document.destroy = cleanup\n\n  return cleanup\n}\n"]}